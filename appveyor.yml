version: '{branch}-{build}'

#init:
#  - ps: iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))

#on_finish:
#  - ps: $blockRdp = $true; iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))

install:
  - choco install unitypackager
  - cinst docfx
  - choco install lftp
  - npm install -g semantic-release@15 

#build:
#  project: Mirror/Networking.sln
#  verbosity: minimal
  
# Do not build on tags (GitHub only)
skip_tags: true

build_script:
  - docfx metadata doc\docfx.json
  - docfx build doc\docfx.json

after_build:
  - RMDIR /Q /S Assets\Mirror\Tests
  - del /F /Q Assets\Mirror\Tests.meta
  - UnityPackager pack Mirror.unitypackage Assets/Mirror Assets/Mirror LICENSE Assets/Mirror/LICENSE

artifacts:
  - path: Mirror.unitypackage
  - path: Assets
    name: Mirror
  - path: doc\_site
    name: docfx

image: Visual Studio 2017

before_deploy:
  - semantic-release

environment:
  LFTP_PASSWORD:
    secure: sH23IC4a98S5uTtgYNHNvg==

deploy_script:
  - semantic-release
  - lftp -c 'pwd' -u mirrofx --env-password mirror-networking.com

